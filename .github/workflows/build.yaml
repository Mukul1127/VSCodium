name: VSCodium CI

on:
  workflow_dispatch:

jobs:
  build:
    name: Build VSCodium
    runs-on: windows-latest
    permissions:
      contents: write
    env:
      THEOS: ${{ github.workspace }}/theos

    steps:
      - name: 🚚 Check out the Repository
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        with:
          repository: VSCodium/vscodium
          path: main

      - name: 💾 Add Sed to Path
        run: |
          echo "C:\msys64\usr\bin" >> "$GITHUB_PATH"

      - name: ⚙️ Add Patch
        working-directory: main/patches
        run: |
          Invoke-WebRequest -OutFile ReAddWCO.patch -Uri https://files.catbox.moe/o253l5.patch

      - name: 📦 Build
        working-directory: main
        run: |
          .\build\build.ps1 -p
          7z a ..\archive.7z . -mx=9

      - name: 🚀 Publish Release
        working-directory: main
        run: |
          gh release create gh-actions-run${{ github.run_number }} ..\archive.7z -R ${{ github.repository }}
        env:
          GH_TOKEN: ${{ github.token }}
