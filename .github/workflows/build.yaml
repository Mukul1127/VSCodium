name: VSCodium CI

on:
  workflow_dispatch:

jobs:
  build:
    name: Build VSCodium
    runs-on: windows-latest
    permissions:
      contents: write
    env:
      THEOS: ${{ github.workspace }}/theos

    steps:
      - name: 🚚 Check out the Repository
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        with:
          repository: VSCodium/vscodium
          path: main

      - name: 💾 Add Sed to Path
        run: |
          echo "C:\msys64\usr\bin" >> "$GITHUB_PATH"

      - name: ⚙️ Add Patch
        working-directory: main/patches
        run: |
          Invoke-WebRequest -OutFile ReAddWCO.patch -Uri https://files.catbox.moe/o253l5.patch

      - name: 📦 Build
        working-directory: main
        run: |
          .\build\build.ps1 -p
          Compress-Archive -Path . -DestinationPath .\zipped.zip

      - name: 🚀 Publish Release
        uses: softprops/action-gh-release@7b4da11513bf3f43f9999e90eabced41ab8bb048 # v2.2.0
        with:
          tag_name: ${{ github.run_number }}
          files: main/zipped.zip
