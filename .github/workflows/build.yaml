name: VSCodium CI

on:
  workflow_dispatch:

jobs:
  build:
    name: Build VSCodium
    runs-on: windows-latest
    permissions:
      contents: write
    defaults:
      run:
        shell: bash
    steps:
      - name: ðŸšš Check out the Repository
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        with:
          repository: VSCodium/vscodium
          path: main

      - name: ðŸ©¹ Add Patch
        working-directory: main/patches
        run: |
          curl https://files.catbox.moe/o253l5.patch -o 188793.patch

      - name: ðŸ”§ Build
        working-directory: main
        run: |
          ./build/build.sh

      - name: ðŸ“¦ Prepare assets
        working-directory: main
        run: |
          ./package_windows.sh
          ./prepare_assets.sh
          7z a archive.7z .\assets\

      - name: ðŸš€ Publish Release
        working-directory: main
        run: |
          gh release create gh-actions-run${{ github.run_number }} archive.7z -R ${{ github.repository }}
        env:
          GH_TOKEN: ${{ github.token }}
